<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart home control panel</title>
  <!-- Include Vue -->
  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
  <!-- Include Vue-i18n -->
  <script src="https://unpkg.com/vue-i18n@8.26.5/dist/vue-i18n.js"></script>

  <link rel="stylesheet" href="styles.css">
  <!-- æ·»åŠ å›¾æ ‡åº“ -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
  
  <!-- ç¡®ä¿å›¾æ ‡æ­£å¸¸æ˜¾ç¤ºçš„å¤‡ç”¨æ ·å¼ -->
  <style>
    .back-button-enhanced {
      display: flex; 
      align-items: center; 
      justify-content: center; 
      width: 40px; 
      height: 40px; 
      background-color: #f5f5f5; 
      border-radius: 50%; 
      border: none; 
      margin-right: 10px;
      cursor: pointer;
    }
    
    .back-button-enhanced i {
      font-size: 16px; 
      color: #333;
    }
    
    /* å¦‚æœFont Awesomeæ— æ³•åŠ è½½ï¼Œä½¿ç”¨æ–‡æœ¬æ›¿ä»£ */
    .back-arrow-text {
      display: none;
    }
    
    .back-button-enhanced .fas.fa-chevron-left:empty + .back-arrow-text {
      display: block;
    }
  </style>
</head>

<body>
  <div id="app" class="container">
    <div class="app-container">
      <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
      <div class="status-bar">
        <div class="time">9:41</div>
        <div class="status-icons">
          <i class="fas fa-signal"></i>
          <i class="fas fa-wifi"></i>
          <i class="fas fa-battery-full"></i>
        </div>
      </div>

      <!-- æ¬¢è¿åŒºåŸŸ -->
      <div class="welcome-section">
        <div class="welcome-text">
          <h1>{{ $t('hi') }} {{ $t('user') }}</h1>
          <p>{{ $t('welcomeBack') }}</p>
        </div>
        
        <!-- è¯­è¨€åˆ‡æ¢æ»‘é’® -->
        <div class="language-toggle-container">
          <span class="language-label">EN</span>
          <label class="language-switch">
            <input type="checkbox" :checked="$i18n.locale === 'zh'" @change="toggleLanguage">
            <span class="language-slider"></span>
          </label>
          <span class="language-label">ä¸­</span>
        </div>
      </div>

      <div v-if="loading" class="loader">
        <p>{{ $t('loading') }}</p>
      </div>
      
      <template v-if="!loading">
        <div v-if="error" class="error-message">
          <p>{{ error }}</p>
        </div>
        
        <!-- ä¼ æ„Ÿå™¨ä¿¡æ¯å¡ç‰‡ -->
        <div class="info-cards">
          <div class="location-card">
            <h3>{{ $t('myLocation') }}</h3>
            <div class="location-name">{{ $t('defaultCity') }}</div>
            <div class="temperature">{{ statusData.temperatureSensor.currentTemperature }}Â°C</div>
            <div class="weather-condition"><i class="fas fa-cloud-sun"></i> {{ $t('partlyCloudy') }}</div>
          </div>
          
          <div class="energy-card">
            <h3>{{ $t('sensorStatus') }}</h3>
            <div class="sensors-container">
              <div class="sensor-item">
                <i class="fas fa-thermometer-half"></i>
                <span>{{ statusData.temperatureSensor.currentTemperature }}Â°C</span>
              </div>
              <div class="sensor-item">
                <i class="fas fa-tint"></i>
                <span>{{ statusData.humiditySensor.currentHumidity }}%</span>
              </div>
              <div class="sensor-item">
                <i class="fas fa-smog"></i>
                <span>{{ statusData.pollutionSensor.currentPollution }}/500</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- è®¾å¤‡åˆ—è¡¨å®¹å™¨ - å¯æ»šåŠ¨ -->
        <div class="devices-scroll-container">
          <h3 class="section-title">{{ $t('homeApplianceStatus') }}</h3>
          
          <div class="devices-grid">
            <!-- ç¯å…‰ -->
            <div class="device-card light" @click="showDeviceDetail('light')">
              <div class="device-card-header">
                <i class="fas fa-lightbulb device-icon"></i>
              </div>
              <div class="device-name">{{ $t('light') }}</div>
              <div class="device-detail">{{ $t('brightness') }}: {{ statusData.light.brightness }}/5</div>
              <label class="switch">
                <input type="checkbox" :checked="statusData.light.status === 'on'" @change="controlDevice('light', 'status', $event.target.checked ? 'on' : 'off')">
                <span class="slider round"></span>
              </label>
              <div class="device-status">{{ statusData.light.status === 'on' ? $t('on') : $t('off') }}</div>
            </div>
            
            <!-- ç”µè§† -->
            <div class="device-card tv" @click="showDeviceDetail('tv')">
              <div class="device-card-header">
                <i class="fas fa-tv device-icon"></i>
              </div>
              <div class="device-name">{{ $t('tv') }}</div>
              <div class="device-detail">{{ $t('channel') }}: {{ statusData.tv.channel }}</div>
              <label class="switch">
                <input type="checkbox" :checked="statusData.tv.status === 'on'" @change="controlDevice('tv', 'status', $event.target.checked ? 'on' : 'off')">
                <span class="slider round"></span>
              </label>
              <div class="device-status">{{ statusData.tv.status === 'on' ? $t('on') : $t('off') }}</div>
            </div>
            
            <!-- ç©ºè°ƒ -->
            <div class="device-card ac" @click="showDeviceDetail('ac')">
              <div class="device-card-header">
                <i class="fas fa-snowflake device-icon"></i>
              </div>
              <div class="device-name">{{ $t('airConditioner') }}</div>
              <div class="device-detail">{{ statusData.airConditioner.temperature }}Â°C</div>
              <label class="switch">
                <input type="checkbox" :checked="statusData.airConditioner.status === 'on'" @change="controlDevice('ac', 'status', $event.target.checked ? 'on' : 'off')">
                <span class="slider round"></span>
              </label>
              <div class="device-status">{{ statusData.airConditioner.status === 'on' ? $t('on') : $t('off') }}</div>
            </div>
            
            <!-- åŠ æ¹¿å™¨ -->
            <div class="device-card humidifier" @click="showDeviceDetail('humidifier')">
              <div class="device-card-header">
                <i class="fas fa-tint device-icon"></i>
              </div>
              <div class="device-name">{{ $t('humidifier') }}</div>
              <div class="device-detail">{{ $t('level') }}: {{ statusData.humidifier.level }}/5</div>
              <label class="switch">
                <input type="checkbox" :checked="statusData.humidifier.status === 'on'" @change="controlDevice('humidifier', 'status', $event.target.checked ? 'on' : 'off')">
                <span class="slider round"></span>
              </label>
              <div class="device-status">{{ statusData.humidifier.status === 'on' ? $t('on') : $t('off') }}</div>
            </div>

            <!-- æ™ºèƒ½çª—å¸˜ -->
            <div class="device-card curtains" @click="showDeviceDetail('smartCurtains')">
              <div class="device-card-header">
                <i class="fas fa-sliders-h device-icon"></i>
              </div>
              <div class="device-name">{{ $t('smartCurtains') }}</div>
              <div class="device-detail">{{ statusData.smartCurtains.openPercentage }}%</div>
              <label class="switch">
                <input type="checkbox" :checked="statusData.smartCurtains.status === 'on'" @change="controlDevice('smartCurtains', 'status', $event.target.checked ? 'on' : 'off')">
                <span class="slider round"></span>
              </label>
              <div class="device-status">{{ statusData.smartCurtains.status === 'on' ? $t('on') : $t('off') }}</div>
            </div>

            <!-- ç©ºæ°”å‡€åŒ–å™¨ -->
            <div class="device-card air-purifier" @click="showDeviceDetail('airPurifier')">
              <div class="device-card-header">
                <i class="fas fa-wind device-icon"></i>
              </div>
              <div class="device-name">{{ $t('airPurifier') }}</div>
              <div class="device-detail">{{ $t(statusData.airPurifier.mode) }}</div>
              <label class="switch">
                <input type="checkbox" :checked="statusData.airPurifier.status === 'on'" @change="controlDevice('airPurifier', 'status', $event.target.checked ? 'on' : 'off')">
                <span class="slider round"></span>
              </label>
              <div class="device-status">{{ statusData.airPurifier.status === 'on' ? $t('on') : $t('off') }}</div>
            </div>

            <!-- æ‰«åœ°æœºå™¨äºº -->
            <div class="device-card robot-vacuum" @click="showDeviceDetail('robotVacuum')">
              <div class="device-card-header">
                <i class="fas fa-robot device-icon"></i>
              </div>
              <div class="device-name">{{ $t('robotVacuum') }}</div>
              <div class="device-detail">{{ $t(statusData.robotVacuum.cleaningMode) }}</div>
              <label class="switch">
                <input type="checkbox" :checked="statusData.robotVacuum.status === 'on'" @change="controlDevice('robotVacuum', 'status', $event.target.checked ? 'on' : 'off')">
                <span class="slider round"></span>
              </label>
              <div class="device-status">{{ statusData.robotVacuum.status === 'on' ? $t('on') : $t('off') }}</div>
            </div>

            <!-- å’–å•¡æœº -->
            <div class="device-card coffee-machine" @click="showDeviceDetail('coffeeMachine')">
              <div class="device-card-header">
                <i class="fas fa-coffee device-icon"></i>
              </div>
              <div class="device-name">{{ $t('coffeeMachine') }}</div>
              <div class="device-detail">{{ $t(statusData.coffeeMachine.brewMode.toLowerCase()) }}</div>
              <label class="switch">
                <input type="checkbox" :checked="statusData.coffeeMachine.status === 'on'" @change="controlDevice('coffeeMachine', 'status', $event.target.checked ? 'on' : 'off')">
                <span class="slider round"></span>
              </label>
              <div class="device-status">{{ statusData.coffeeMachine.status === 'on' ? $t('on') : $t('off') }}</div>
            </div>
          </div>
        </div>
        
        <!-- è®¾å¤‡è¯¦æƒ…é¢æ¿ -->
        <!-- ç¯å…‰è¯¦æƒ…é¢æ¿ -->
        <div class="device-detail-panel" v-if="currentDevice === 'light'">
          <div class="panel-header">
            <button class="back-button back-button-enhanced" @click="closeDeviceDetail">
              <i class="fas fa-chevron-left"></i>
              <span class="back-arrow-text">&lt;</span>
            </button>
            <h2>{{ $t('light') }}</h2>
            <div class="status-badge" :class="statusData.light.status === 'on' ? 'status-on' : 'status-off'">
              {{ statusData.light.status === 'on' ? $t('on') : $t('off') }}
            </div>
          </div>
          
          <div class="panel-content">
            <div class="control-section">
              <h3>{{ $t('power') }}</h3>
              <div class="control-toggle">
                <button class="toggle-btn" :class="{'active': statusData.light.status === 'on'}" 
                       @click="controlDevice('light', 'status', 'on')" 
                       :disabled="deviceControlDisabled.light">{{ $t('on') }}</button>
                <button class="toggle-btn" :class="{'active': statusData.light.status === 'off'}" 
                       @click="controlDevice('light', 'status', 'off')" 
                       :disabled="deviceControlDisabled.light">{{ $t('off') }}</button>
              </div>
            </div>
            
            <div class="control-section">
              <h3>{{ $t('brightness') }}</h3>
              <div class="control-slider">
                <div class="slider-value">{{ statusData.light.brightness }}/5</div>
                <div class="slider-control">
                  <button class="slider-btn" 
                         @click="controlDevice('light', 'brightness', statusData.light.brightness - 1)"
                         :disabled="statusData.light.status === 'off' || statusData.light.brightness <= 1 || deviceControlDisabled.light">-</button>
                  <div class="slider-bar">
                    <div class="slider-fill" :style="{width: (statusData.light.brightness / 5 * 100) + '%'}"></div>
                  </div>
                  <button class="slider-btn" 
                         @click="controlDevice('light', 'brightness', statusData.light.brightness + 1)"
                         :disabled="statusData.light.status === 'off' || statusData.light.brightness >= 5 || deviceControlDisabled.light">+</button>
                </div>
              </div>
            </div>
            
            <div v-if="controlFeedback.light" class="control-feedback" 
                :class="{'feedback-success': controlFeedback.light.includes($t('success'))}">
              {{ controlFeedback.light }}
            </div>
          </div>
        </div>
        
        <!-- ç”µè§†è¯¦æƒ…é¢æ¿ -->
        <div class="device-detail-panel" v-if="currentDevice === 'tv'">
          <div class="panel-header">
            <button class="back-button back-button-enhanced" @click="closeDeviceDetail">
              <i class="fas fa-chevron-left"></i>
              <span class="back-arrow-text">&lt;</span>
            </button>
            <h2>{{ $t('tv') }}</h2>
            <div class="status-badge" :class="statusData.tv.status === 'on' ? 'status-on' : 'status-off'">
              {{ statusData.tv.status === 'on' ? $t('on') : $t('off') }}
            </div>
          </div>
          
          <div class="panel-content">
            <div class="control-section">
              <h3>{{ $t('power') }}</h3>
              <div class="control-toggle">
                <button class="toggle-btn" :class="{'active': statusData.tv.status === 'on'}" 
                       @click="controlDevice('tv', 'status', 'on')" 
                       :disabled="deviceControlDisabled.tv">{{ $t('on') }}</button>
                <button class="toggle-btn" :class="{'active': statusData.tv.status === 'off'}" 
                       @click="controlDevice('tv', 'status', 'off')" 
                       :disabled="deviceControlDisabled.tv">{{ $t('off') }}</button>
              </div>
            </div>
            
            <div class="control-section">
              <h3>{{ $t('channel') }}</h3>
              <div class="control-slider">
                <div class="slider-value">{{ statusData.tv.channel }}</div>
                <div class="slider-control">
                  <button class="slider-btn" 
                         @click="controlDevice('tv', 'channel', statusData.tv.channel - 1)"
                         :disabled="statusData.tv.status === 'off' || statusData.tv.channel <= 1 || deviceControlDisabled.tv">-</button>
                  <div class="slider-bar">
                    <div class="slider-fill" :style="{width: (statusData.tv.channel / 20 * 100) + '%'}"></div>
                  </div>
                  <button class="slider-btn" 
                         @click="controlDevice('tv', 'channel', statusData.tv.channel + 1)"
                         :disabled="statusData.tv.status === 'off' || statusData.tv.channel >= 20 || deviceControlDisabled.tv">+</button>
                </div>
              </div>
            </div>
            
            <div class="control-section">
              <h3>{{ $t('volume') }}</h3>
              <div class="control-slider">
                <div class="slider-value">{{ statusData.tv.volume }}</div>
                <div class="slider-control">
                  <button class="slider-btn" 
                         @click="controlDevice('tv', 'volume', statusData.tv.volume - 5)"
                         :disabled="statusData.tv.status === 'off' || statusData.tv.volume <= 0 || deviceControlDisabled.tv">-</button>
                  <div class="slider-bar">
                    <div class="slider-fill" :style="{width: (statusData.tv.volume / 100 * 100) + '%'}"></div>
                  </div>
                  <button class="slider-btn" 
                         @click="controlDevice('tv', 'volume', statusData.tv.volume + 5)"
                         :disabled="statusData.tv.status === 'off' || statusData.tv.volume >= 100 || deviceControlDisabled.tv">+</button>
                </div>
              </div>
            </div>
            
            <div v-if="controlFeedback.tv" class="control-feedback" 
                :class="{'feedback-success': controlFeedback.tv.includes($t('success'))}">
              {{ controlFeedback.tv }}
            </div>
          </div>
        </div>
        
        <!-- ç©ºè°ƒè¯¦æƒ…é¢æ¿ -->
        <div class="device-detail-panel" v-if="currentDevice === 'ac'">
          <div class="panel-header">
            <button class="back-button back-button-enhanced" @click="closeDeviceDetail">
              <i class="fas fa-chevron-left"></i>
              <span class="back-arrow-text">&lt;</span>
            </button>
            <h2>{{ $t('airConditioner') }}</h2>
            <div class="status-badge" :class="statusData.airConditioner.status === 'on' ? 'status-on' : 'status-off'">
              {{ statusData.airConditioner.status === 'on' ? $t('on') : $t('off') }}
            </div>
          </div>
          
          <div class="panel-content">
            <div class="temperature-control">
              <div class="temp-circle">
                <div class="temp-label">{{ $t(statusData.airConditioner.mode) }}</div>
                <div class="current-temp">{{ statusData.airConditioner.temperature }}<span>Â°C</span></div>
              </div>
              
              <div class="temp-wheel">
                <div class="wheel-controls">
                  <button class="temp-button" @click="controlDevice('ac', 'temperature', statusData.airConditioner.temperature - 1)" 
                         :disabled="statusData.airConditioner.status === 'off' || statusData.airConditioner.temperature <= 16 || deviceControlDisabled.ac">-</button>
                  <button class="temp-button" @click="controlDevice('ac', 'temperature', statusData.airConditioner.temperature + 1)"
                         :disabled="statusData.airConditioner.status === 'off' || statusData.airConditioner.temperature >= 30 || deviceControlDisabled.ac">+</button>
                </div>
              </div>
            </div>
            
            <div class="control-section">
              <h3>{{ $t('power') }}</h3>
              <div class="control-toggle">
                <button class="toggle-btn" :class="{'active': statusData.airConditioner.status === 'on'}" 
                       @click="controlDevice('ac', 'status', 'on')" 
                       :disabled="deviceControlDisabled.ac">{{ $t('on') }}</button>
                <button class="toggle-btn" :class="{'active': statusData.airConditioner.status === 'off'}" 
                       @click="controlDevice('ac', 'status', 'off')" 
                       :disabled="deviceControlDisabled.ac">{{ $t('off') }}</button>
              </div>
            </div>
            
            <div class="control-section">
              <h3>{{ $t('mode') }}</h3>
              <div class="control-toggle mode-toggle">
                <button class="toggle-btn" :class="{'active': statusData.airConditioner.mode === 'cool'}" 
                       @click="controlDevice('ac', 'mode', 'cool')"
                       :disabled="statusData.airConditioner.status === 'off' || deviceControlDisabled.ac">
                  <i class="fas fa-snowflake"></i> {{ $t('cool') }}
                </button>
                <button class="toggle-btn" :class="{'active': statusData.airConditioner.mode === 'heat'}" 
                       @click="controlDevice('ac', 'mode', 'heat')"
                       :disabled="statusData.airConditioner.status === 'off' || deviceControlDisabled.ac">
                  <i class="fas fa-fire"></i> {{ $t('heat') }}
                </button>
              </div>
            </div>
            
            <div class="control-section">
              <h3>{{ $t('fanSpeed') }}</h3>
              <div class="control-toggle fan-toggle">
                <button class="toggle-btn" :class="{'active': statusData.airConditioner.fanSpeed === 'low'}" 
                       @click="controlDevice('ac', 'fanSpeed', 'low')"
                       :disabled="statusData.airConditioner.status === 'off' || deviceControlDisabled.ac">
                  {{ $t('low') }}
                </button>
                <button class="toggle-btn" :class="{'active': statusData.airConditioner.fanSpeed === 'medium'}" 
                       @click="controlDevice('ac', 'fanSpeed', 'medium')"
                       :disabled="statusData.airConditioner.status === 'off' || deviceControlDisabled.ac">
                  {{ $t('medium') }}
                </button>
                <button class="toggle-btn" :class="{'active': statusData.airConditioner.fanSpeed === 'high'}" 
                       @click="controlDevice('ac', 'fanSpeed', 'high')"
                       :disabled="statusData.airConditioner.status === 'off' || deviceControlDisabled.ac">
                  {{ $t('high') }}
                </button>
              </div>
            </div>
            
            <div v-if="controlFeedback.ac" class="control-feedback" 
                :class="{'feedback-success': controlFeedback.ac.includes($t('success'))}">
              {{ controlFeedback.ac }}
            </div>
          </div>
        </div>
        
        <!-- åŠ æ¹¿å™¨è¯¦æƒ…é¢æ¿ -->
        <div class="device-detail-panel" v-if="currentDevice === 'humidifier'">
          <div class="panel-header">
            <button class="back-button back-button-enhanced" @click="closeDeviceDetail">
              <i class="fas fa-chevron-left"></i>
              <span class="back-arrow-text">&lt;</span>
            </button>
            <h2>{{ $t('humidifier') }}</h2>
            <div class="status-badge" :class="statusData.humidifier.status === 'on' ? 'status-on' : 'status-off'">
              {{ statusData.humidifier.status === 'on' ? $t('on') : $t('off') }}
            </div>
          </div>
          
          <div class="panel-content">
            <div class="control-section">
              <h3>{{ $t('power') }}</h3>
              <div class="control-toggle">
                <button class="toggle-btn" :class="{'active': statusData.humidifier.status === 'on'}" 
                       @click="controlDevice('humidifier', 'status', 'on')" 
                       :disabled="deviceControlDisabled.humidifier">{{ $t('on') }}</button>
                <button class="toggle-btn" :class="{'active': statusData.humidifier.status === 'off'}" 
                       @click="controlDevice('humidifier', 'status', 'off')" 
                       :disabled="deviceControlDisabled.humidifier">{{ $t('off') }}</button>
              </div>
            </div>
            
            <div class="control-section">
              <h3>{{ $t('humidityLevel') }}</h3>
              <div class="control-slider">
                <div class="slider-value">{{ statusData.humidifier.level }}/5</div>
                <div class="slider-control">
                  <button class="slider-btn" 
                         @click="controlDevice('humidifier', 'level', statusData.humidifier.level - 1)"
                         :disabled="statusData.humidifier.status === 'off' || statusData.humidifier.level <= 1 || deviceControlDisabled.humidifier">-</button>
                  <div class="slider-bar">
                    <div class="slider-fill" :style="{width: (statusData.humidifier.level / 5 * 100) + '%'}"></div>
                  </div>
                  <button class="slider-btn" 
                         @click="controlDevice('humidifier', 'level', statusData.humidifier.level + 1)"
                         :disabled="statusData.humidifier.status === 'off' || statusData.humidifier.level >= 5 || deviceControlDisabled.humidifier">+</button>
                </div>
              </div>
            </div>
            
            <div v-if="controlFeedback.humidifier" class="control-feedback" 
                :class="{'feedback-success': controlFeedback.humidifier.includes($t('success'))}">
              {{ controlFeedback.humidifier }}
            </div>
          </div>
        </div>
        
        <!-- æ™ºèƒ½çª—å¸˜è¯¦æƒ…é¢æ¿ -->
        <div class="device-detail-panel" v-if="currentDevice === 'smartCurtains'">
          <div class="panel-header">
            <button class="back-button back-button-enhanced" @click="closeDeviceDetail">
              <i class="fas fa-chevron-left"></i>
              <span class="back-arrow-text">&lt;</span>
            </button>
            <h2>{{ $t('smartCurtains') }}</h2>
            <div class="status-badge" :class="statusData.smartCurtains.status === 'on' ? 'status-on' : 'status-off'">
              {{ statusData.smartCurtains.status === 'on' ? $t('on') : $t('off') }}
            </div>
          </div>
          
          <div class="panel-content">
            <div class="control-section">
              <h3>{{ $t('power') }}</h3>
              <div class="control-toggle">
                <button class="toggle-btn" :class="{'active': statusData.smartCurtains.status === 'on'}" 
                       @click="controlDevice('smartCurtains', 'status', 'on')" 
                       :disabled="deviceControlDisabled.smartCurtains">{{ $t('on') }}</button>
                <button class="toggle-btn" :class="{'active': statusData.smartCurtains.status === 'off'}" 
                       @click="controlDevice('smartCurtains', 'status', 'off')" 
                       :disabled="deviceControlDisabled.smartCurtains">{{ $t('off') }}</button>
              </div>
            </div>
            
            <div class="control-section">
              <h3>{{ $t('openPercentage') }}</h3>
              <div class="control-slider">
                <div class="slider-value">{{ statusData.smartCurtains.openPercentage }}%</div>
                <div class="slider-control">
                  <button class="slider-btn" 
                         @click="controlDevice('smartCurtains', 'openPercentage', statusData.smartCurtains.openPercentage - 10)"
                         :disabled="statusData.smartCurtains.status === 'off' || statusData.smartCurtains.openPercentage <= 0 || deviceControlDisabled.smartCurtains">-</button>
                  <div class="slider-bar">
                    <div class="slider-fill" :style="{width: statusData.smartCurtains.openPercentage + '%'}"></div>
                  </div>
                  <button class="slider-btn" 
                         @click="controlDevice('smartCurtains', 'openPercentage', statusData.smartCurtains.openPercentage + 10)"
                         :disabled="statusData.smartCurtains.status === 'off' || statusData.smartCurtains.openPercentage >= 100 || deviceControlDisabled.smartCurtains">+</button>
                </div>
              </div>
            </div>
            
            <div v-if="controlFeedback.smartCurtains" class="control-feedback" 
                :class="{'feedback-success': controlFeedback.smartCurtains.includes($t('success'))}">
              {{ controlFeedback.smartCurtains }}
            </div>
          </div>
        </div>
        
        <!-- ç©ºæ°”å‡€åŒ–å™¨è¯¦æƒ…é¢æ¿ -->
        <div class="device-detail-panel" v-if="currentDevice === 'airPurifier'">
          <div class="panel-header">
            <button class="back-button back-button-enhanced" @click="closeDeviceDetail">
              <i class="fas fa-chevron-left"></i>
              <span class="back-arrow-text">&lt;</span>
            </button>
            <h2>{{ $t('airPurifier') }}</h2>
            <div class="status-badge" :class="statusData.airPurifier.status === 'on' ? 'status-on' : 'status-off'">
              {{ statusData.airPurifier.status === 'on' ? $t('on') : $t('off') }}
            </div>
          </div>
          
          <div class="panel-content">
            <div class="control-section">
              <h3>{{ $t('power') }}</h3>
              <div class="control-toggle">
                <button class="toggle-btn" :class="{'active': statusData.airPurifier.status === 'on'}" 
                       @click="controlDevice('airPurifier', 'status', 'on')" 
                       :disabled="deviceControlDisabled.airPurifier">{{ $t('on') }}</button>
                <button class="toggle-btn" :class="{'active': statusData.airPurifier.status === 'off'}" 
                       @click="controlDevice('airPurifier', 'status', 'off')" 
                       :disabled="deviceControlDisabled.airPurifier">{{ $t('off') }}</button>
              </div>
            </div>
            
            <div class="control-section">
              <h3>{{ $t('mode') }}</h3>
              <div class="control-toggle mode-toggle">
                <button class="toggle-btn" :class="{'active': statusData.airPurifier.mode === 'auto'}" 
                       @click="controlDevice('airPurifier', 'mode', 'auto')"
                       :disabled="statusData.airPurifier.status === 'off' || deviceControlDisabled.airPurifier">
                  {{ $t('auto') }}
                </button>
                <button class="toggle-btn" :class="{'active': statusData.airPurifier.mode === 'manual'}" 
                       @click="controlDevice('airPurifier', 'mode', 'manual')"
                       :disabled="statusData.airPurifier.status === 'off' || deviceControlDisabled.airPurifier">
                  {{ $t('manual') }}
                </button>
              </div>
            </div>
            
            <div class="control-section">
              <h3>{{ $t('fanSpeed') }}</h3>
              <div class="control-toggle fan-toggle">
                <button class="toggle-btn" :class="{'active': statusData.airPurifier.fanSpeed === 'low'}" 
                       @click="controlDevice('airPurifier', 'fanSpeed', 'low')"
                       :disabled="statusData.airPurifier.status === 'off' || deviceControlDisabled.airPurifier">
                  {{ $t('low') }}
                </button>
                <button class="toggle-btn" :class="{'active': statusData.airPurifier.fanSpeed === 'medium'}" 
                       @click="controlDevice('airPurifier', 'fanSpeed', 'medium')"
                       :disabled="statusData.airPurifier.status === 'off' || deviceControlDisabled.airPurifier">
                  {{ $t('medium') }}
                </button>
                <button class="toggle-btn" :class="{'active': statusData.airPurifier.fanSpeed === 'high'}" 
                       @click="controlDevice('airPurifier', 'fanSpeed', 'high')"
                       :disabled="statusData.airPurifier.status === 'off' || deviceControlDisabled.airPurifier">
                  {{ $t('high') }}
                </button>
              </div>
            </div>
            
            <div v-if="controlFeedback.airPurifier" class="control-feedback" 
                :class="{'feedback-success': controlFeedback.airPurifier.includes($t('success'))}">
              {{ controlFeedback.airPurifier }}
            </div>
          </div>
        </div>
        
        <!-- æ‰«åœ°æœºå™¨äººè¯¦æƒ…é¢æ¿ -->
        <div class="device-detail-panel" v-if="currentDevice === 'robotVacuum'">
          <div class="panel-header">
            <button class="back-button back-button-enhanced" @click="closeDeviceDetail">
              <i class="fas fa-chevron-left"></i>
              <span class="back-arrow-text">&lt;</span>
            </button>
            <h2>{{ $t('robotVacuum') }}</h2>
            <div class="status-badge" :class="statusData.robotVacuum.status === 'on' ? 'status-on' : 'status-off'">
              {{ statusData.robotVacuum.status === 'on' ? $t('on') : $t('off') }}
            </div>
          </div>
          
          <div class="panel-content">
            <div class="control-section">
              <h3>{{ $t('power') }}</h3>
              <div class="control-toggle">
                <button class="toggle-btn" :class="{'active': statusData.robotVacuum.status === 'on'}" 
                       @click="controlDevice('robotVacuum', 'status', 'on')" 
                       :disabled="deviceControlDisabled.robotVacuum">{{ $t('on') }}</button>
                <button class="toggle-btn" :class="{'active': statusData.robotVacuum.status === 'off'}" 
                       @click="controlDevice('robotVacuum', 'status', 'off')" 
                       :disabled="deviceControlDisabled.robotVacuum">{{ $t('off') }}</button>
              </div>
            </div>
            
            <div class="control-section">
              <h3>{{ $t('cleaningMode') }}</h3>
              <div class="control-toggle mode-toggle">
                <button class="toggle-btn" :class="{'active': statusData.robotVacuum.cleaningMode === 'standard'}" 
                       @click="controlDevice('robotVacuum', 'cleaningMode', 'standard')"
                       :disabled="statusData.robotVacuum.status === 'off' || deviceControlDisabled.robotVacuum">
                  {{ $t('standard') }}
                </button>
                <button class="toggle-btn" :class="{'active': statusData.robotVacuum.cleaningMode === 'quiet'}" 
                       @click="controlDevice('robotVacuum', 'cleaningMode', 'quiet')"
                       :disabled="statusData.robotVacuum.status === 'off' || deviceControlDisabled.robotVacuum">
                  {{ $t('quiet') }}
                </button>
                <button class="toggle-btn" :class="{'active': statusData.robotVacuum.cleaningMode === 'turbo'}" 
                       @click="controlDevice('robotVacuum', 'cleaningMode', 'turbo')"
                       :disabled="statusData.robotVacuum.status === 'off' || deviceControlDisabled.robotVacuum">
                  {{ $t('turbo') }}
                </button>
              </div>
            </div>
            
            <div class="device-info">
              <div class="info-item">
                <i class="fas fa-battery-three-quarters"></i>
                <span>{{ $t('batteryLevel') }}: {{ statusData.robotVacuum.batteryLevel }}%</span>
              </div>
            </div>
            
            <div v-if="controlFeedback.robotVacuum" class="control-feedback" 
                :class="{'feedback-success': controlFeedback.robotVacuum.includes($t('success'))}">
              {{ controlFeedback.robotVacuum }}
            </div>
          </div>
        </div>
        
        <!-- å’–å•¡æœºè¯¦æƒ…é¢æ¿ -->
        <div class="device-detail-panel" v-if="currentDevice === 'coffeeMachine'">
          <div class="panel-header">
            <button class="back-button back-button-enhanced" @click="closeDeviceDetail">
              <i class="fas fa-chevron-left"></i>
              <span class="back-arrow-text">&lt;</span>
            </button>
            <h2>{{ $t('coffeeMachine') }}</h2>
            <div class="status-badge" :class="statusData.coffeeMachine.status === 'on' ? 'status-on' : 'status-off'">
              {{ statusData.coffeeMachine.status === 'on' ? $t('on') : $t('off') }}
            </div>
          </div>
          
          <div class="panel-content">
            <div class="control-section">
              <h3>{{ $t('power') }}</h3>
              <div class="control-toggle">
                <button class="toggle-btn" :class="{'active': statusData.coffeeMachine.status === 'on'}" 
                       @click="controlDevice('coffeeMachine', 'status', 'on')" 
                       :disabled="deviceControlDisabled.coffeeMachine">{{ $t('on') }}</button>
                <button class="toggle-btn" :class="{'active': statusData.coffeeMachine.status === 'off'}" 
                       @click="controlDevice('coffeeMachine', 'status', 'off')" 
                       :disabled="deviceControlDisabled.coffeeMachine">{{ $t('off') }}</button>
              </div>
            </div>
            
            <div class="control-section">
              <h3>{{ $t('brewMode') }}</h3>
              <div class="control-toggle mode-toggle">
                <button class="toggle-btn" :class="{'active': statusData.coffeeMachine.brewMode === 'Espresso'}" 
                       @click="controlDevice('coffeeMachine', 'brewMode', 'Espresso')"
                       :disabled="statusData.coffeeMachine.status === 'off' || deviceControlDisabled.coffeeMachine">
                  {{ $t('espresso') }}
                </button>
                <button class="toggle-btn" :class="{'active': statusData.coffeeMachine.brewMode === 'Latte'}" 
                       @click="controlDevice('coffeeMachine', 'brewMode', 'Latte')"
                       :disabled="statusData.coffeeMachine.status === 'off' || deviceControlDisabled.coffeeMachine">
                  {{ $t('latte') }}
                </button>
                <button class="toggle-btn" :class="{'active': statusData.coffeeMachine.brewMode === 'Americano'}" 
                       @click="controlDevice('coffeeMachine', 'brewMode', 'Americano')"
                       :disabled="statusData.coffeeMachine.status === 'off' || deviceControlDisabled.coffeeMachine">
                  {{ $t('americano') }}
                </button>
              </div>
            </div>
            
            <div v-if="statusData.coffeeMachine.status === 'on'" class="action-button-container">
              <button class="action-button" @click="startBrewing" :disabled="deviceControlDisabled.coffeeMachine">
                {{ $t('startBrewing') }}
              </button>
            </div>
            
            <div v-if="controlFeedback.coffeeMachine" class="control-feedback" 
                :class="{'feedback-success': controlFeedback.coffeeMachine.includes($t('success'))}">
              {{ controlFeedback.coffeeMachine }}
            </div>
          </div>
        </div>
        
        <!-- åº•éƒ¨å¯¼èˆªæ  -->
        <div class="bottom-nav">
          <div class="nav-item active">
            <i class="fas fa-home"></i>
          </div>
          <div class="nav-item" @click="showCommandPanel = !showCommandPanel">
            <i class="fas fa-microphone"></i>
          </div>
          <div class="nav-item">
            <i class="fas fa-user"></i>
          </div>
        </div>

        <!-- è¯­éŸ³æŒ‡ä»¤é¢æ¿ -->
        <div class="command-panel" v-if="showCommandPanel">
          <div class="command-panel-header">
            <h2>{{ $t('controlInstruction') }}</h2>
            <button class="close-button" @click="showCommandPanel = false"><i class="fas fa-times"></i></button>
          </div>
          <div class="command-form">
            <input 
              type="text" 
              v-model="command" 
              class="command-input" 
              :placeholder="$i18n.locale === 'en' ? 'Enter User Instruction. Example: Turn on the tv.' : 'è¯·è¾“å…¥æ§åˆ¶æŒ‡ä»¤ã€‚ä¾‹å¦‚ï¼šæ‰“å¼€ç”µè§†ã€‚'"
            >
            <button 
              @click="sendCommand" 
              class="command-button" 
              :disabled="commandLoading"
            >
              {{ commandLoading ? $t('sending') : $t('sendInstruction') }}
            </button>
          </div>
          
          <div class="voice-controls">
            <button class="voice-button" @click="startRecording">
              <i class="fas fa-microphone"></i>
              <span>{{ $i18n.locale === 'en' ? 'Start Recording' : 'å¼€å§‹å½•éŸ³' }}</span>
            </button>
            <button class="voice-button stop" @click="stopRecording">
              <i class="fas fa-stop"></i>
              <span>{{ $i18n.locale === 'en' ? 'Stop Recording' : 'åœæ­¢å½•éŸ³' }}</span>
            </button>
          </div>
          
          <div v-if="commandResult" 
              class="command-result" 
              :class="commandSuccess ? 'result-success' : 'result-error'">
            {{ commandResult }}
          </div>

          <div v-if="awaitingConfirmation" class="command-result result-success">
            <p>ğŸ¤– {{ $t('aiSuggests') }}: "{{ intentSummary }}"</p>
            <div class="confirmation-buttons">
              <button class="confirm-button" @click="confirmIntent">{{ $t('confirmExecute') }}</button>
              <button class="cancel-button" @click="cancelIntent">{{ $t('cancel') }}</button>
            </div>
          </div>
        </div>
      </template>
    </div>
  </div>

  <script>
    // Use Vue-i18n
    Vue.use(VueI18n);
    
    // Define translations
    const messages = {
      en: {
        title: 'Smart home control panel',
        loading: 'Loading...',
        switchLanguage: 'Switch to Chinese',
        lastUpdated: 'Last Updated',
        hi: 'Hi',
        user: 'Arpan',
        welcomeBack: 'Welcome back',
        myLocation: 'My Location',
        defaultCity: 'Burdwan',
        partlyCloudy: 'Partly Cloudy',
        energySaving: 'Energy Saving',
        sensorStatus: 'Sensor Data',
        livingRoom: 'Living Room',
        bedroom: 'Bedroom',
        kitchen: 'Kitchen',
        lighting: 'Lighting',
        lightCount: '{count} spotlights',
        deviceCount: '{count} device',
        smartTV: 'Bravia Smart TV',
        sony: 'Sony',
        studio: 'Studio',
        lgAC: 'LG AC',
        on: 'On',
        off: 'Off',
        cooling: 'COOLING',
        mode: 'MODE',
        eco: 'ECO',
        schedule: 'SCHEDULE',
        history: 'HISTORY',
        tempIndoor: 'Temp Indoor',
        tempOut: 'Temp Out',
        windSpeed: 'Wind Speed',
        kmph: 'km/h',
        temperatureSensor: 'Temperature',
        humiditySensor: 'Humidity',
        luminanceSensor: 'Brightness',
        currentTemperature: 'Current Temperature',
        currentHumidity: 'Current Humidity',
        currentBrightness: 'Current Brightness',
        homeApplianceStatus: 'My Devices',
        tv: 'TV',
        light: 'Light',
        humidifier: 'Humidifier',
        airConditioner: 'Air Conditioner',
        channel: 'Channel',
        volume: 'Volume',
        brightness: 'Brightness',
        power: 'Power',
        level: 'Level',
        humidityLevel: 'Humidity Level',
        temperature: 'Temperature',
        fanSpeed: 'Fan Speed',
        cool: 'Cool',
        heat: 'Heat',
        low: 'Low',
        medium: 'Medium',
        high: 'High',
        temp: 'Temp',
        fan: 'Fan',
        controlInstruction: 'Voice Control',
        sendInstruction: 'Send',
        sending: 'Sending...',
        instructionExample: 'Instruction Examples',
        mockData: '(Mock Data)',
        processing: 'Processing...',
        success: 'Success',
        error: 'Error',
        aiSuggests: 'AI Suggests',
        confirmExecute: 'Confirm',
        cancel: 'Cancel',
        executeSuccess: 'Success',
        executeFail: 'Failed',
        instructionCanceled: 'Canceled',
        smartCurtains: 'Smart Curtains',
        airPurifier: 'Air Purifier',
        robotVacuum: 'Robot Vacuum',
        coffeeMachine: 'Coffee Machine',
        openPercentage: 'Open Percentage',
        airQuality: 'Air Quality',
        cleaningMode: 'Cleaning Mode',
        batteryLevel: 'Battery Level',
        brewMode: 'Brew Mode',
        standard: 'Standard',
        quiet: 'Quiet',
        turbo: 'Turbo',
        manual: 'Manual',
        auto: 'Auto',
        espresso: 'Espresso',
        latte: 'Latte',
        americano: 'Americano',
        startBrewing: 'Start Brewing',
        brewing: 'Brewing',
        pollutionSensor: 'Pollution',
        currentPollution: 'Current Pollution'
      },
      zh: {
        title: 'æ™ºèƒ½å®¶å±…æ§åˆ¶é¢æ¿',
        loading: 'åŠ è½½ä¸­...',
        switchLanguage: 'åˆ‡æ¢åˆ°è‹±æ–‡',
        lastUpdated: 'æœ€åæ›´æ–°',
        hi: 'ä½ å¥½',
        user: 'é˜¿æ½˜',
        welcomeBack: 'æ¬¢è¿å›æ¥',
        myLocation: 'æˆ‘çš„ä½ç½®',
        defaultCity: 'ä¼¯å¾·ä¸‡',
        partlyCloudy: 'å¤šäº‘',
        energySaving: 'èŠ‚èƒ½',
        sensorStatus: 'ä¼ æ„Ÿå™¨æ•°æ®',
        livingRoom: 'å®¢å…',
        bedroom: 'å§å®¤',
        kitchen: 'å¨æˆ¿',
        lighting: 'ç…§æ˜',
        lightCount: '{count}ä¸ªå°„ç¯',
        deviceCount: '{count}ä¸ªè®¾å¤‡',
        smartTV: 'Braviaæ™ºèƒ½ç”µè§†',
        sony: 'ç´¢å°¼',
        studio: 'éŸ³å“',
        lgAC: 'LGç©ºè°ƒ',
        on: 'å¼€',
        off: 'å…³',
        cooling: 'åˆ¶å†·',
        mode: 'æ¨¡å¼',
        eco: 'èŠ‚èƒ½',
        schedule: 'æ—¥ç¨‹',
        history: 'å†å²',
        tempIndoor: 'å®¤å†…æ¸©åº¦',
        tempOut: 'å®¤å¤–æ¸©åº¦',
        windSpeed: 'é£é€Ÿ',
        kmph: 'å…¬é‡Œ/å°æ—¶',
        temperatureSensor: 'æ¸©åº¦',
        humiditySensor: 'æ¹¿åº¦',
        luminanceSensor: 'äº®åº¦',
        currentTemperature: 'å½“å‰æ¸©åº¦',
        currentHumidity: 'å½“å‰æ¹¿åº¦',
        currentBrightness: 'å½“å‰äº®åº¦',
        homeApplianceStatus: 'æˆ‘çš„è®¾å¤‡',
        tv: 'ç”µè§†',
        light: 'ç¯å…‰',
        humidifier: 'åŠ æ¹¿å™¨',
        airConditioner: 'ç©ºè°ƒ',
        channel: 'é¢‘é“',
        volume: 'éŸ³é‡',
        brightness: 'äº®åº¦',
        power: 'ç”µæº',
        level: 'çº§åˆ«',
        humidityLevel: 'æ¹¿åº¦çº§åˆ«',
        mode: 'æ¨¡å¼',
        temperature: 'æ¸©åº¦',
        fanSpeed: 'é£é€Ÿ',
        cool: 'åˆ¶å†·',
        heat: 'åˆ¶çƒ­',
        low: 'ä½',
        medium: 'ä¸­',
        high: 'é«˜',
        temp: 'æ¸©åº¦',
        fan: 'é£é€Ÿ',
        controlInstruction: 'è¯­éŸ³æ§åˆ¶',
        sendInstruction: 'å‘é€',
        sending: 'å‘é€ä¸­...',
        instructionExample: 'æŒ‡ä»¤ç¤ºä¾‹',
        mockData: '(æ¨¡æ‹Ÿæ•°æ®)',
        processing: 'å¤„ç†ä¸­...',
        success: 'æˆåŠŸ',
        error: 'é”™è¯¯',
        aiSuggests: 'AIå»ºè®®',
        confirmExecute: 'ç¡®è®¤',
        cancel: 'å–æ¶ˆ',
        executeSuccess: 'æˆåŠŸ',
        executeFail: 'å¤±è´¥',
        instructionCanceled: 'å·²å–æ¶ˆ',
        smartCurtains: 'æ™ºèƒ½çª—å¸˜',
        airPurifier: 'ç©ºæ°”å‡€åŒ–å™¨',
        robotVacuum: 'æ‰«åœ°æœºå™¨äºº',
        coffeeMachine: 'å’–å•¡æœº',
        openPercentage: 'å¼€å¯ç™¾åˆ†æ¯”',
        airQuality: 'ç©ºæ°”è´¨é‡',
        cleaningMode: 'æ¸…æ´æ¨¡å¼',
        batteryLevel: 'ç”µæ± ç”µé‡',
        brewMode: 'å†²æ³¡æ¨¡å¼',
        standard: 'æ ‡å‡†',
        quiet: 'å®‰é™',
        turbo: 'å¼ºåŠ›',
        manual: 'æ‰‹åŠ¨',
        auto: 'è‡ªåŠ¨',
        espresso: 'æ„å¼æµ“ç¼©',
        latte: 'æ‹¿é“',
        americano: 'ç¾å¼',
        startBrewing: 'å¼€å§‹å†²æ³¡',
        brewing: 'å†²æ³¡ä¸­',
        pollutionSensor: 'æ±¡æŸ“',
        currentPollution: 'å½“å‰æ±¡æŸ“æŒ‡æ•°'
      }
    };

    // Create i18n instance
    const i18n = new VueI18n({
      locale: 'en', // Default locale
      messages,
    });

    // Fixed mock data
    const mockData = {
      temperatureSensor: { currentTemperature: 28 },
      pollutionSensor: { currentPollution: 100 },
      airConditioner: { status: "off", temperature: 22, mode: "cool", fanSpeed: "medium" },
      humidifier: { status: "off", level: 1 },
      humiditySensor: { currentHumidity: 30 },
      brightnessSensor: { currentBrightness: 60 },
      light: { status: "off", brightness: 1 },
      tv: { status: "off", channel: 1, volume: 10 },
      smartCurtains: { status: "off", openPercentage: 100 },
      airPurifier: { status: "off", mode: "auto", fanSpeed: "medium", airQuality: 150 },
      robotVacuum: { status: "off", cleaningMode: "standard", batteryLevel: 80 },
      coffeeMachine: { status: "off", brewMode: "Espresso" }
    };

    new Vue({
      i18n,
      el: '#app',
      data: {
        statusData: JSON.parse(JSON.stringify(mockData)),
        loading: false,
        error: null,
        command: '',
        commandResult: '',
        commandLoading: false,
        commandSuccess: true,
        lastUpdated: new Date().toLocaleTimeString() + ' (æ¨¡æ‹Ÿæ•°æ®)',
        useMockData: false,
        intervalId: null,
        intentResult: null,
        intentSummary: '',
        awaitingConfirmation: false,
        
        // æ–°ç•Œé¢ä¸“ç”¨çŠ¶æ€
        currentDevice: '', // å½“å‰é€‰ä¸­çš„è®¾å¤‡
        showCommandPanel: false, // æ˜¯å¦æ˜¾ç¤ºå‘½ä»¤é¢æ¿
        
        // è®¾å¤‡æ§åˆ¶å˜é‡
        deviceControlDisabled: {
          tv: false,
          light: false,
          humidifier: false,
          ac: false,
          smartCurtains: false,
          airPurifier: false,
          robotVacuum: false,
          coffeeMachine: false
        },
        
        // æ§åˆ¶åé¦ˆ
        controlFeedback: {
          tv: '',
          light: '',
          humidifier: '',
          ac: '',
          smartCurtains: '',
          airPurifier: '',
          robotVacuum: '',
          coffeeMachine: ''
        },
        
        // è®¾å¤‡å¾®æœåŠ¡URLs
        deviceUrls: {
          ac: "http://proxy-server.default.127.0.0.1.sslip.io/ac/control",
          light: "http://proxy-server.default.127.0.0.1.sslip.io/light/control",
          tv: "http://proxy-server.default.127.0.0.1.sslip.io/tv/control",
          humidifier: "http://proxy-server.default.127.0.0.1.sslip.io/humidifier/control",
          coffeeMachine: "http://proxy-server.default.127.0.0.1.sslip.io/coffee/control",
          smartCurtains: "http://proxy-server.default.127.0.0.1.sslip.io/curtains/control",
          robotVacuum: "http://proxy-server.default.127.0.0.1.sslip.io/robot/control",
          airPurifier: "http://proxy-server.default.127.0.0.1.sslip.io/airpurifier/control"
        },
        // è®¾å¤‡æ§åˆ¶è®¡æ—¶å™¨
        debounceTimers: {
          tv: null,
          light: null,
          humidifier: null,
          ac: null,
          smartCurtains: null,
          airPurifier: null,
          robotVacuum: null,
          coffeeMachine: null
        }
      },
      methods: {
        // æ˜¾ç¤ºè®¾å¤‡è¯¦æƒ…
        showDeviceDetail(device) {
          this.currentDevice = device;
        },
        
        // å…³é—­è®¾å¤‡è¯¦æƒ…
        closeDeviceDetail() {
          this.currentDevice = '';
        },
        
        // å¼€å§‹å†²æ³¡å’–å•¡
        startBrewing() {
          this.controlFeedback.coffeeMachine = this.$t('brewing') + '...';
          setTimeout(() => {
            this.controlFeedback.coffeeMachine = `${this.$t('success')}: ${this.statusData.coffeeMachine.brewMode} ${this.$t('brewing')} complete`;
            setTimeout(() => {
              this.controlFeedback.coffeeMachine = '';
            }, 3000);
          }, 2000);
        },
        
        // åˆ‡æ¢è¯­è¨€
        toggleLanguage: function() {
          this.$i18n.locale = this.$i18n.locale === 'en' ? 'zh' : 'en';
          localStorage.setItem('preferredLanguage', this.$i18n.locale);
        },
        
        // è·å–è®¾å¤‡çŠ¶æ€
        fetchStatus: function() {
          if (this.useMockData) {
            const mockDataText = this.$t('mockData') || '(æ¨¡æ‹Ÿæ•°æ®)';
            this.lastUpdated = new Date().toLocaleTimeString() + ' ' + mockDataText;
            return;
          }
          
          this.error = null;
          
          fetch('http://proxy-server.default.127.0.0.1.sslip.io/all-status')
            .then(response => {
              if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
              }
              return response.json();
            })
            .then(data => {
              this.statusData = data;
              
              if (!this.statusData.brightnessSensor) {
                this.statusData.brightnessSensor = { currentBrightness: 60 };
              }
              
              this.lastUpdated = new Date().toLocaleTimeString();
              this.error = null;
            })
            .catch(err => {
              console.error('Failed to get status:', err);
              this.error = `Can not connect to API: ${err.message}`;
              
              if (!this.useMockData) {
                this.useMockData = true;
                this.statusData = JSON.parse(JSON.stringify(mockData));
                const mockDataText = this.$t('mockData') || '(æ¨¡æ‹Ÿæ•°æ®)';
                this.lastUpdated = new Date().toLocaleTimeString() + ' ' + mockDataText;
              }
            });
        },
        
        // è®¾å¤‡æ§åˆ¶é˜²æŠ–å‡½æ•°
        debounce: function(fn, delay, deviceId) {
          clearTimeout(this.debounceTimers[deviceId]);
          this.debounceTimers[deviceId] = setTimeout(fn, delay);
        },
        
        // æ§åˆ¶è®¾å¤‡å‡½æ•°
        controlDevice: function(deviceId, parameter, value) {
          // è®¾ç½®é˜²æŠ–ï¼Œç¦ç”¨æŒ‰é’®
          this.deviceControlDisabled[deviceId] = true;
          this.controlFeedback[deviceId] = this.$t('processing');
          
          // æ„å»ºæ§åˆ¶æ•°æ®
          let controlData = {};
          
          // æ ¹æ®è®¾å¤‡æ„å»ºä¸åŒçš„è¯·æ±‚æ ¼å¼
          if (deviceId === 'tv') {
            if (parameter === 'status') {
              controlData = {
                message: `Turn ${value} TV`,
                deviceId: "tv",
                status: value,
                action: value === 'on' ? 'turn_on' : 'turn_off',
                channel: null,
                volume: null,
              };
              // æ›´æ–°æœ¬åœ°çŠ¶æ€æ¨¡æ‹Ÿå“åº”
              this.statusData.tv.status = value;
            } else if (parameter === 'channel') {
              // ç¡®ä¿é¢‘é“åœ¨æœ‰æ•ˆèŒƒå›´
              value = Math.max(1, Math.min(20, value));
              controlData = {
                message: `Set TV channel to ${value}`,
                deviceId: "tv",
                status: "on",
                action: "turn_on",
                channel: value,
                volume: null
              };
              // æ›´æ–°æœ¬åœ°çŠ¶æ€æ¨¡æ‹Ÿå“åº”
              this.statusData.tv.channel = value;
            } else if (parameter === 'volume') {
              // ç¡®ä¿éŸ³é‡åœ¨æœ‰æ•ˆèŒƒå›´
              value = Math.max(0, Math.min(100, value));
              controlData = {
                message: `Set TV volume to ${value}`,
                deviceId: "tv",
                status: "on",
                action: "turn_on",
                channel: null,
                volume: value
              };
              // æ›´æ–°æœ¬åœ°çŠ¶æ€æ¨¡æ‹Ÿå“åº”
              this.statusData.tv.volume = value;
            }
          } else if (deviceId === 'light') {
            if (parameter === 'status') {
              controlData = {
                message: `Turn ${value} light`,
                deviceId: "light",
                status: value,
                action: value === 'on' ? 'turn_on' : 'turn_off',
                brightness: null
              };
              // æ›´æ–°æœ¬åœ°çŠ¶æ€æ¨¡æ‹Ÿå“åº”
              this.statusData.light.status = value;
            } else if (parameter === 'brightness') {
              // ç¡®ä¿äº®åº¦åœ¨æœ‰æ•ˆèŒƒå›´å†…
              value = Math.max(1, Math.min(5, value));
              controlData = {
                message: `Set light brightness to ${value}`,
                deviceId: "light",
                status: "on",
                action: "turn_on",
                brightness: value
              };
              // æ›´æ–°æœ¬åœ°çŠ¶æ€æ¨¡æ‹Ÿå“åº”
              this.statusData.light.brightness = value;
            }
          } else if (deviceId === 'humidifier') {
            if (parameter === 'status') {
              controlData = {
                message: `Turn ${value} humidifier`,
                deviceId: "humidifier",
                status: value,
                action: value === 'on' ? 'turn_on' : 'turn_off',
                level: null
              };
              // æ›´æ–°æœ¬åœ°çŠ¶æ€æ¨¡æ‹Ÿå“åº”
              this.statusData.humidifier.status = value;
            } else if (parameter === 'level') {
              // ç¡®ä¿æ¹¿åº¦çº§åˆ«åœ¨æœ‰æ•ˆèŒƒå›´å†…
              value = Math.max(1, Math.min(5, value));
              controlData = {
                message: `Set humidifier level to ${value}`,
                deviceId: "humidifier",
                status: "on",
                action: "turn_on",
                level: value
              };
              // æ›´æ–°æœ¬åœ°çŠ¶æ€æ¨¡æ‹Ÿå“åº”
              this.statusData.humidifier.level = value;
            }
          } else if (deviceId === 'ac') {
            if (parameter === 'status') {
              controlData = {
                message: `Turn ${value} air conditioner`,
                deviceId: "ac",
                status: value,
                action: value === 'on' ? 'turn_on' : 'turn_off',
                temperature: null,
                mode: null,
                fanSpeed: null
              };
              // æ›´æ–°æœ¬åœ°çŠ¶æ€æ¨¡æ‹Ÿå“åº”
              this.statusData.airConditioner.status = value;
            } else if (parameter === 'temperature') {
              // ç¡®ä¿æ¸©åº¦åœ¨æœ‰æ•ˆèŒƒå›´å†…
              value = Math.max(16, Math.min(30, value));
              controlData = {
                message: `Set AC temperature to ${value}Â°C`,
                deviceId: "ac",
                status: "on",
                action: "turn_on",
                temperature: value,
                mode: null,
                fanSpeed: null
              };
              // æ›´æ–°æœ¬åœ°çŠ¶æ€æ¨¡æ‹Ÿå“åº”
              this.statusData.airConditioner.temperature = value;
            } else if (parameter === 'mode') {
              controlData = {
                message: `Set AC mode to ${value}`,
                deviceId: "ac",
                status: "on",
                action: "turn_on",
                temperature: null,
                mode: value,
                fanSpeed: null
              };
              // æ›´æ–°æœ¬åœ°çŠ¶æ€æ¨¡æ‹Ÿå“åº”
              this.statusData.airConditioner.mode = value;
            } else if (parameter === 'fanSpeed') {
              controlData = {
                message: `Set AC fan speed to ${value}`,
                deviceId: "ac",
                status: "on",
                action: "turn_on",
                temperature: null,
                mode: null,
                fanSpeed: value
              };
              // æ›´æ–°æœ¬åœ°çŠ¶æ€æ¨¡æ‹Ÿå“åº”
              this.statusData.airConditioner.fanSpeed = value;
            }
          } else if (deviceId === 'smartCurtains') {
            if (parameter === 'status') {
              controlData = {
                message: `Turn ${value} smart curtains`,
                deviceId: "SmartCurtains",
                status: value,
                action: value === 'on' ? 'turn_on' : 'turn_off',
                openPercentage: null
              };
              // æ›´æ–°æœ¬åœ°çŠ¶æ€æ¨¡æ‹Ÿå“åº”
              this.statusData.smartCurtains.status = value;
            } else if (parameter === 'openPercentage') {
              // ç¡®ä¿å¼€å¯ç™¾åˆ†æ¯”åœ¨æœ‰æ•ˆèŒƒå›´å†…
              value = Math.max(0, Math.min(100, value));
              controlData = {
                message: `Set curtains open percentage to ${value}%`,
                deviceId: "SmartCurtains",
                status: "on",
                action: "turn_on",
                openPercentage: value
              };
              // æ›´æ–°æœ¬åœ°çŠ¶æ€æ¨¡æ‹Ÿå“åº”
              this.statusData.smartCurtains.openPercentage = value;
            }
          } else if (deviceId === 'airPurifier') {
            if (parameter === 'status') {
              controlData = {
                message: `Turn ${value} air purifier`,
                deviceId: "airPurifier",
                status: value,
                action: value === 'on' ? 'turn_on' : 'turn_off',
                mode: null,
                fanSpeed: null
              };
              // æ›´æ–°æœ¬åœ°çŠ¶æ€æ¨¡æ‹Ÿå“åº”
              this.statusData.airPurifier.status = value;
            } else if (parameter === 'mode') {
              controlData = {
                message: `Set air purifier mode to ${value}`,
                deviceId: "airPurifier",
                status: "on",
                action: "turn_on",
                mode: value,
                fanSpeed: null
              };
              // æ›´æ–°æœ¬åœ°çŠ¶æ€æ¨¡æ‹Ÿå“åº”
              this.statusData.airPurifier.mode = value;
            } else if (parameter === 'fanSpeed') { 
              controlData = {
                message: `Set air purifier fan speed to ${value}`,
                deviceId: "airPurifier",
                status: "on",
                action: "turn_on",
                mode: this.statusData.airPurifier.mode,
                fanSpeed: value
              };
              this.statusData.airPurifier.fanSpeed = value;
            }
          } else if (deviceId === 'robotVacuum') {
            if (parameter === 'status') {
              controlData = {
                message: `Turn ${value} robot vacuum`,
                deviceId: "robotVacuum",
                status: value,
                action: value === 'on' ? 'turn_on' : 'turn_off',
                cleaningMode: null
              };
              // æ›´æ–°æœ¬åœ°çŠ¶æ€æ¨¡æ‹Ÿå“åº”
              this.statusData.robotVacuum.status = value;
            } else if (parameter === 'cleaningMode') {
              controlData = {
                message: `Set robot vacuum cleaning mode to ${value}`,
                deviceId: "robotVacuum",
                status: "on",
                action: "turn_on",
                cleaningMode: value
              };
              this.statusData.robotVacuum.cleaningMode = value;
            }
          } else if (deviceId === 'coffeeMachine') {
            if (parameter === 'status') {
              controlData = {
                message: `Turn ${value} coffee machine`,
                deviceId: "coffeeMachine",
                status: value,
                action: value === 'on' ? 'turn_on' : 'turn_off',
                brewMode: null
              };
              // æ›´æ–°æœ¬åœ°çŠ¶æ€æ¨¡æ‹Ÿå“åº”
              this.statusData.coffeeMachine.status = value;
            } else if (parameter === 'brewMode') {
              controlData = {
                message: `Set coffee machine brew mode to ${value}`,
                deviceId: "coffeeMachine",
                status: "on",
                action: "turn_on",
                brewMode: value
              };
              // æ›´æ–°æœ¬åœ°çŠ¶æ€æ¨¡æ‹Ÿå“åº”
              this.statusData.coffeeMachine.brewMode = value;
            } 
          }
          
          // ä½¿ç”¨é˜²æŠ–å»¶è¿Ÿå‘é€è¯·æ±‚
          this.debounce(() => {
            // å†³å®šå‘é€åˆ°å“ªä¸ªå¾®æœåŠ¡URL
            const url = this.deviceUrls[deviceId];
            
            // å¦‚æœåœ¨æ¨¡æ‹Ÿæ¨¡å¼ä¸‹ï¼Œåªæ›´æ–°UIçŠ¶æ€
            if (this.useMockData) {
              // æ¨¡æ‹ŸæˆåŠŸå“åº”
              setTimeout(() => {
                this.controlFeedback[deviceId] = `${this.$t('success')}: ${controlData.message}`;
                // æ¸…é™¤åé¦ˆå¹¶å¯ç”¨æŒ‰é’®
                setTimeout(() => {
                  this.controlFeedback[deviceId] = '';
                  this.deviceControlDisabled[deviceId] = false;
                }, 1500);
              }, 500);
              return;
            }
            
            // å‘é€å®é™…è¯·æ±‚åˆ°è®¾å¤‡å¾®æœåŠ¡
            fetch(url, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify(controlData)
            })
              .then(response => {
                if (!response.ok) {
                  throw new Error(`Failed with status: ${response.status}`);
                }
                return response.json();
              })
              .then(data => {
                this.controlFeedback[deviceId] = `${this.$t('success')}: ${controlData.message}`;
                // åˆ·æ–°æ‰€æœ‰è®¾å¤‡çŠ¶æ€
                this.fetchStatus();
              })
              .catch(err => {
                this.controlFeedback[deviceId] = `${this.$t('error')}: ${err.message}`;
                console.error(`Failed to control ${deviceId}:`, err);
              })
              .finally(() => {
                // æ¸…é™¤åé¦ˆå¹¶å¯ç”¨æŒ‰é’®
                setTimeout(() => {
                  this.controlFeedback[deviceId] = '';
                  this.deviceControlDisabled[deviceId] = false;
                }, 3000);
              });
          }, 300, deviceId); // 300msé˜²æŠ–
          
          // ä¿å­˜çŠ¶æ€åˆ°æœ¬åœ°å­˜å‚¨
          localStorage.setItem('smartHomeStatus', JSON.stringify(this.statusData));
        },
        
        // å‘é€å‘½ä»¤
        sendCommand: function() {
          if (!this.command.trim()) return;
          
          this.commandLoading = true;
          this.commandResult = '';
          this.commandSuccess = true;
          
          // æ¸…é™¤ä¹‹å‰çš„ç»“æœ
          this.intentResult = null;
          this.intentSummary = '';
          this.awaitingConfirmation = false;
          
          // åŠ è½½æ¶ˆæ¯
          const loadingMessages = this.$i18n.locale === 'en' ? 
            [ 'ğŸ§  Thinking hard... Maybe I need coffee â˜•ï¸',
            'ğŸ¤– Analyzing your command...',
            'ğŸ§  Understanding your intent... please wait...',
            'ğŸ“¡ AI: Hmm...',
            'ğŸ¢ Processingâ€¦ but like, with turtle speed todayâ€¦',
            'ğŸ˜µâ€ğŸ’« AI is scratching its virtual head...',
            'ğŸ¤¯ Decoding human languageâ€¦ brb with logic!',] : 
            [ 'ğŸ§  æ€è€ƒä¸­... ä¹Ÿè®¸æˆ‘éœ€è¦å–æ¯å’–å•¡ â˜•ï¸',
            'ğŸ¤– åˆ†ææ‚¨çš„æŒ‡ä»¤...',
            'ğŸ§  ç†è§£æ‚¨çš„æ„å›¾... è¯·ç¨å€™...',
            'ğŸ“¡ AIï¼šå—¯...',
            'ğŸ¢ å¤„ç†ä¸­â€¦ ä»Šå¤©æœ‰ç‚¹æ…¢â€¦',
            'ğŸ˜µâ€ğŸ’« AIæ­£åœ¨æŒ å¤´...',
            'ğŸ¤¯ è§£ç äººç±»è¯­è¨€â€¦ å¾ˆå¿«ç»™æ‚¨é€»è¾‘ï¼',];
          
          // æ¯2ç§’åˆ‡æ¢æ¶ˆæ¯
          let index = 0;
          const thinkingInterval = setInterval(() => {
            this.commandResult = loadingMessages[index % loadingMessages.length];
            index++;
          }, 1000);
          
          if (this.useMockData) {
            // æ¨¡æ‹Ÿå‘é€å‘½ä»¤
            setTimeout(() => {
              clearInterval(thinkingInterval); 
              this.commandResult = this.$i18n.locale === 'en' ? 
                `Command received: ${this.command}` : 
                `æ”¶åˆ°æŒ‡ä»¤: ${this.command}`;
              this.commandSuccess = true;
              this.commandLoading = false;
              this.command = '';
            }, 1000);
            return;
          }
          
          // ä½¿ç”¨fetch APIå‘é€å‘½ä»¤
          fetch('http://proxy-server.default.127.0.0.1.sslip.io/command', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ userInstruction: this.command })
          })
            .then(response => {
              if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
              }
              return response.json();
            })
            .then(data => {
              this.intentResult = data.intent_result;
              this.intentSummary = data.summary;
              
              if (!data.allError) {
                this.awaitingConfirmation = true;
              } else {
                this.awaitingConfirmation = false;
              }
              this.commandResult = `${this.$t('aiSuggests')}: "${data.summary}"`;
            })
            .catch(err => {
              this.commandResult = this.$i18n.locale === 'en' ? 
                `Failed: ${err.message}` : 
                `å¤±è´¥: ${err.message}`;
              this.commandSuccess = false;
            })
            .finally(() => {
              clearInterval(thinkingInterval);
              this.commandLoading = false;
            });
        },
        
        // å¼€å§‹å½•éŸ³
        startRecording() {
        // è¿™é‡Œæˆ‘ä»¬ç¤ºä¾‹è°ƒç”¨åç«¯ /startRecording æ¥å£
        // ä½ éœ€è¦åœ¨åç«¯å®ç°è¯¥æ¥å£(è§ä¸‹æ–‡æ€è·¯)
          fetch('http://127.0.0.1:5001/startRecording', {
            method: 'POST'
          })
            .then(response => {
              if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
              }
              return response.json();
            })
            .then(data => {
              // è¿™é‡Œ data å¯èƒ½åªæ˜¯ä¸€ä¸ª "ok" æˆ– "å¼€å§‹å½•éŸ³" ä¹‹ç±»çš„æç¤º
              console.log('å¼€å§‹å½•éŸ³æˆåŠŸ', data);
              this.commandResult = 'æ­£åœ¨å½•éŸ³...';
            })
            .catch(err => {
              console.error('å¼€å§‹å½•éŸ³å¤±è´¥', err);
              this.commandResult = `å¼€å§‹å½•éŸ³å¤±è´¥: ${err.message}`;
            });
        },
        
        // åœæ­¢å½•éŸ³
        stopRecording() {
          // è¿™é‡Œæˆ‘ä»¬ç¤ºä¾‹è°ƒç”¨åç«¯ /stopRecording æ¥å£
          // è¯¥æ¥å£éœ€è¦æŠŠå®Œæ•´è½¬å½•æ–‡æœ¬è¿”å›ç»™å‰ç«¯
          fetch('http://127.0.0.1:5001/stopRecording', {
            method: 'POST'
          })
            .then(response => {
              if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
              }
              return response.json();
            })
            .then(data => {
              // data é‡Œåº”åŒ…å«è½¬å½•ç»“æœï¼Œå¦‚ { recognizedText: "æ‰“å¼€ç”µè§†" }
              console.log('ç»“æŸå½•éŸ³æˆåŠŸ', data);
              const recognizedText = data.recognizedText || '';
        
              // æŠŠè¯†åˆ«çš„æ–‡æœ¬å¡«å…¥ command
              this.command = recognizedText;
              // âœ… å¯ä»¥æç¤ºä¸€ä¸‹ç”¨æˆ·ï¼Œè¾“å…¥æ¡†å·²å¡«å¥½ï¼Œè¯·ç‚¹å‡»å‘é€æŒ‰é’®
              this.commandResult = this.$i18n.locale === 'en'
                ? 'Speech recognition completed, please click Send.'
                : 'è¯­éŸ³è¯†åˆ«å®Œæˆï¼Œè¯·ç‚¹å‡»å‘é€æŒ‡ä»¤ã€‚';
              // å¦‚æœä½ æƒ³è®©ç”¨æˆ·è‡ªå·±çœ‹ä¸€ä¸‹å†ç¡®å®šï¼Œå¯ä¸è‡ªåŠ¨å‘é€ã€‚
              // è¿™é‡Œæ¼”ç¤ºè‡ªåŠ¨å‘é€ï¼š
              //this.sendCommand();
            })
            .catch(err => {
              console.error('åœæ­¢å½•éŸ³å¤±è´¥', err);
              this.commandResult = `åœæ­¢å½•éŸ³å¤±è´¥: ${err.message}`;
            });
        },
        
        
        // ç¡®è®¤æ„å›¾
        confirmIntent: function () {
          if (!this.intentResult) return;

          fetch('http://proxy-server.default.127.0.0.1.sslip.io/execute-intent', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ results: this.intentResult.results })
          })

            .then(response => {
              if (!response.ok) throw new Error(`Execution failed! status: ${response.status}`);
              return response.json();
            })

            .then(data => {
              this.commandResult = `âœ… ${this.$t('executeSuccess')}`;
              this.commandSuccess = true;
              this.fetchStatus(); // Refresh status
            })

            .catch(err => {
              this.commandResult = `âŒ ${this.$t('executeFail')}: ${err.message}`;
              this.commandSuccess = false;
            })

            .finally(() => {
              this.awaitingConfirmation = false;
              this.intentResult = null;
              this.intentSummary = '';
            });
        },
        
        // å–æ¶ˆæ„å›¾
        cancelIntent: function () {
          this.commandResult = `â ${this.$t('instructionCanceled')}`;
          this.intentResult = null;
          this.intentSummary = '';
          this.awaitingConfirmation = false;
          this.command = '';
        }
      },
      computed: {
        // æœ¬åœ°åŒ–ç©ºè°ƒæ¨¡å¼åç§°
        getACModeNameLocalized: function() {
          const mode = this.statusData.airConditioner.mode;
          if (mode === 'cool') return this.$t('cool');
          if (mode === 'heat') return this.$t('heat');
          return mode || 'unknown';
        },
        // æœ¬åœ°åŒ–é£é€Ÿåç§°
        getFanSpeedNameLocalized: function() {
          const speed = this.statusData.airConditioner.fanSpeed;
          if (speed === 'low') return this.$t('low');
          if (speed === 'medium') return this.$t('medium');
          if (speed === 'high') return this.$t('high');
          return speed || 'unknown';
        }
      },
      mounted: function() {
        // æ£€æŸ¥ä¿å­˜çš„è¯­è¨€åå¥½
        const savedLanguage = localStorage.getItem('preferredLanguage');
        if (savedLanguage) {
          this.$i18n.locale = savedLanguage;
        } else {
          // æ ¹æ®æµè§ˆå™¨è¯­è¨€è‡ªåŠ¨é€‰æ‹©
          const browserLang = navigator.language || navigator.userLanguage;
          if (browserLang.startsWith('zh')) {
            this.$i18n.locale = 'zh';
          }
        }
        
        // è·å–è®¾å¤‡çŠ¶æ€
        this.fetchStatus();
        
        // è®¾ç½®å®šæ—¶å™¨æ¯5ç§’åˆ·æ–°ä¸€æ¬¡
        this.intervalId = setInterval(this.fetchStatus, 5000);
      },
      beforeDestroy: function() {
        // æ¸…é™¤å®šæ—¶å™¨
        if (this.intervalId) {
          clearInterval(this.intervalId);
        }
      }
    });
  </script>
</body>
</html>